const elementListCctv=document.getElementById("list-cctv");const elementContainer=document.getElementById("container");const elementInputLocation=document.getElementById("search-location");const elementCountLocation=document.getElementById("count-location");const modalInfo=document.getElementById("modal-info");const buttonInfo=document.getElementById("button-info");const buttonCloseModal=document.getElementById("button-close-modal");const body=document.getElementsByTagName("body")[0];const basePath=window.location.hostname==="yudapratama25.github.io"?"https://yudapratama25.github.io/cctv-viewer/":"/";let widthDevice=screen.width;let apis=[];let listCctv=[];let selectedLocations=[];let isIOS=false;var isForbidden=false;const checkIOS=()=>{if(typeof window===`undefined`||typeof navigator===`undefined`)return false;return/iPhone|iPad|iPod/i.test(navigator.userAgent||navigator.vendor||window.opera&&opera.toString()===`[object Opera]`)};const buildShortName=e=>{let t=e.toLowerCase();if(t.includes("cctv")){t=t.replace("cctv","")}if(t.includes("simpang")){t=t.replace("simpang","simp.")}return t.trim().toUpperCase()};const buildListCctv=()=>{let e=``;elementCountLocation.innerText=listCctv.length;listCctv.map(((t,o)=>{e+=`<li class="px-2 py-1 text-sm rounded-lg shadow inline-flex items-center justify-items-center">`+`<input type="checkbox" id="location-${t.id}" class="me-1" onchange="selectCctv(${o},'${t.id}')"${selectedLocations.includes(t.id.toString())?" checked":""}/>`+`<label for="location-${t.id}" class="text-white overflow-hidden text-nowrap text-ellipsis" title="${t.location}">${buildShortName(t.location)}</label>`+`</li>`}));if(widthDevice>640){if(listCctv.length<15){elementListCctv.style.gridTemplateRows="repeat(3, auto)"}else if(listCctv.length<25){elementListCctv.style.gridTemplateRows="repeat(5, auto)"}else{elementListCctv.style.gridTemplateRows="repeat(10, auto)"}}else{elementListCctv.style.gridTemplateRows="repeat(5, auto)"}elementListCctv.innerHTML=e};const adjustVideoPlayerSize=()=>{let e=selectedLocations.length;const t=document.getElementsByClassName("video-player");if(widthDevice>768){if(e==1){elementContainer.classList.add("h-screen")}else{elementContainer.classList.remove("h-screen")}}for(let o=0;o<t.length;o++){if(e==1){t[o].classList.add("h-full");t[o].classList.add("w-full")}else{t[o].classList.remove("h-full");t[o].classList.remove("w-full")}}};const selectCctv=(e,t)=>{const o=unselectCctv(t);if(o){return false}if(selectedLocations.length==6){document.getElementById(`location-${t}`).checked=false;alert("Maksimal hanya dapat menampilkan 6 lokasi.");return false}const n=listCctv[e];const i=widthDevice<640?"":" p-3";const s=widthDevice<640?"bottom-0 left-0":"bottom-3 left-3";const l=widthDevice<640?"bottom-0 right-0":"bottom-3 right-3";const a=widthDevice<640?"bottom-12 right-0":"bottom-12 right-3";const c=!isIOS?" h-full":"";let d=`<div id="container-video-player-${t}" class="video-player relative${i}">\n                    <video\n                        id="video-player-${t}" \n                        class="block rounded-lg${c}" \n                        name="media" \n                        autoplay="" \n                        muted="" \n                        playsinline="" \n                        poster="${basePath}assets/images/loading.jpg"\n                        src="${n.source}"\n                        type="video/fmp4">\n                    </video>\n                    <span class="absolute ${s} px-1 bg-slate-800 text-white text-sm rounded-tr rounded-bl-lg">${buildShortName(n.location)}</span>\n                    <div class="absolute ${l} px-1 bg-slate-800/30 text-white text-sm rounded-tl rounded-br-lg rounded-tr-none backdrop-opacity-10 hover:cursor-pointer hover:bg-slate-400/30" onclick="refreshVideo('${t}')">\n                        <img src="${basePath}assets/images/ic-refresh.png" class="w-7"/>\n                    </div>\n                    <div class="absolute ${a} px-2 py-1 bg-slate-800/30 text-white text-sm rounded-s backdrop-opacity-10 hover:cursor-pointer hover:bg-slate-400/30" onclick="unselectCctv('${t}')">\n                        <img src="${basePath}assets/images/ic-delete.png" class="w-5"/>\n                    </div>\n                </div>`;elementContainer.insertAdjacentHTML("afterbegin",d);selectedLocations.push(t);setTimeout((()=>{adjustVideoPlayerSize()}),600)};const unselectCctv=e=>{if(selectedLocations.includes(e)){selectedLocations=selectedLocations.filter((t=>t!==e));let t=document.getElementById(`video-player-${e}`);t.pause();t.removeAttribute("src");t.load();t.remove();document.getElementById(`container-video-player-${e}`).remove();document.getElementById(`location-${e}`).checked=false;setTimeout((()=>{adjustVideoPlayerSize()}),600);return true}return false};const fetchDataApi=async()=>{await fetch("./cctvSamarinda.json").then((e=>e.json())).then((e=>{apis=e.apis.filter((e=>e.source!==""));listCctv=apis})).catch((e=>console.log(e)))};const debounce=(e,t)=>{let o;return function(...n){clearTimeout(o);o=setTimeout((()=>{e.apply(this,n)}),t)}};const searchLocation=e=>{let t=e.target.value.toLowerCase().trim();if(t===""){listCctv=apis}else{listCctv=apis.filter((e=>e.location.toLowerCase().includes(t)))}buildListCctv()};const refreshVideo=e=>{let t=document.getElementById(`video-player-${e}`);let o=t.getAttribute("src");t.setAttribute("src","");setTimeout((()=>{t.setAttribute("src",o)}),500)};const saveVisitor=()=>{const e=false;if(window.location.hostname==="yudapratama25.github.io"||e){fetch("https://api.ipify.org/?format=json").then((e=>e.json())).then((async function(t){const o=e?"http://localhost:3001/api/cctv-viewer/visitor":"https://aduy-be.vercel.app/api/cctv-viewer/visitor";const n={method:"POST",body:JSON.stringify({ip:t.ip}),headers:{"Content-Type":"application/json"}};fetch(o,n).then((e=>e.json())).then((e=>null)).catch((e=>null))})).catch((e=>null))}};(async function(){isIOS=checkIOS();fetchDataApi().then((e=>{buildListCctv()}));elementInputLocation.addEventListener("keyup",debounce(searchLocation,300));buttonInfo.onclick=function(){modalInfo.style.display="block";body.style.overflow="hidden"};buttonCloseModal.onclick=function(){modalInfo.style.display="none";body.style.overflow="auto"};window.onclick=function(e){if(e.target==modalInfo){modalInfo.style.display="none";body.style.overflow="auto"}};saveVisitor()})();